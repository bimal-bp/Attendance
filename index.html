<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labour Attendance Entry System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
        }
    
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
    
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }
    
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
    
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
    
        .content {
            padding: 30px;
        }

        .attendance-type-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9ff;
            border-radius: 8px;
            border: 1px solid #e0e7ff;
        }

        .attendance-type-section label {
            font-size: 18px;
            font-weight: 600;
            color: #555;
            margin-right: 10px;
        }

        .attendance-type-section select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
        }

        .attendance-type-section select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
            outline: none;
        }

        .attendance-content {
            display: none;
        }

        .attendance-content.active {
            display: block;
        }

        /* ====================== SHARED STYLES ====================== */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
            padding: 0 15px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .table-container {
            overflow-x: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        /* ====================== PLANT STYLING (Purple Theme) ====================== */
        #plantContent .section-title {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eaeaea;
            display: flex;
            align-items: center;
        }

        #plantContent .section-title i {
            margin-right: 10px;
            background-color: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #plantContent .expense-box {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        #plantContent .expense-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        #plantContent .btn-primary {
            background-color: #667eea;
            color: white;
        }

        #plantContent .btn-primary:hover {
            background-color: #5a6fd8;
        }

        #plantContent .preview-table th {
            background-color: #667eea;
            color: white;
        }

        #plantContent .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eaeaea;
        }

        #plantContent .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #plantContent .preview-section {
            background-color: #f8f9ff;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border: 1px solid #e0e7ff;
        }

        /* ====================== QUARRY STYLING (Green Theme) ====================== */
        #quarryContent .header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        #quarryContent .instructions {
            background-color: #e8f5f0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #11998e;
        }

        #quarryContent .btn {
            background-color: #11998e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #quarryContent .btn:hover {
            background-color: #0d7a6b;
        }

        #quarryContent .present-day {
            background-color: #c8e6c9;
            color: #2e7d32;
            font-weight: bold;
        }

        #quarryContent .present-night {
            background-color: #b2dfdb;
            color: #00695c;
            font-weight: bold;
        }

        #quarryContent .absent {
            background-color: #ffcccc;
            color: #900;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .form-group {
                min-width: 100%;
            }
            #plantContent .action-buttons {
                flex-direction: column;
            }
            #plantContent .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-clock"></i> Labour Attendance Entry System</h1>
            <p>SGX Minerals Private Limited - Anakapalli Branch</p>
        </div>
    
        <div class="content">
            <div class="attendance-type-section">
                <label for="attendanceType">Select Attendance Type:</label>
                <select id="attendanceType">
                    <option value="">-- Choose Type --</option>
                    <option value="plant">Plant Attendance (Daily Entry)</option>
                    <option value="quarry">Quarry Attendance (Monthly Sheet)</option>
                </select>
            </div>

            <!-- ====================== PLANT ATTENDANCE (DAILY) ====================== -->
            <div id="plantContent" class="attendance-content">
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-building"></i> Company & Shift Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="company">Company</label>
                            <input type="text" id="company" value="SGX Minerals Private Limited" readonly>
                        </div>
                        <div class="form-group">
                            <label for="branch">Branch</label>
                            <input type="text" id="branch" value="SGX-Anakapalli" readonly>
                        </div>
                        <div class="form-group">
                            <label for="shift">Shift Time</label>
                            <select id="shift">
                                <option value="">-- Select Shift --</option>
                                <option value="morning">Morning Shift (6:00 AM - 2:00 PM)</option>
                                <option value="general" selected>General Shift (9:00 AM - 5:00 PM)</option>
                                <option value="night">Night Shift (10:00 PM - 6:00 AM)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" id="date" value="2025-12-27">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inTime">In Time</label>
                            <input type="time" id="inTime" value="09:00">
                        </div>
                        <div class="form-group">
                            <label for="outTime">Out Time</label>
                            <input type="time" id="outTime" value="17:00">
                        </div>
                    </div>
             
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labourType">Labour Type</label>
                            <select id="labourType">
                                <option value="">-- Select Type --</option>
                                <option value="skilled">Skilled</option>
                                <option value="unskilled" selected>Unskilled</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="activity">Activity</label>
                            <select id="activity">
                                <option value="">-- Select Activity --</option>
                                <option value="development">Development</option>
                                <option value="production" selected>Production</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shiftIncharge">Shift In-Charge</label>
                            <select id="shiftIncharge">
                                <option value="">-- Select In-Charge --</option>
                                <option value="sib" selected>Sib Prasad Komu</option>
                                <option value="bijay">Bijay Parida</option>
                                <option value="krishna">Krishna</option>
                                <option value="jay">Jay Prakash</option>
                                <option value="himanshi">Himanshi</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vendor">Vendor Name</label>
                            <select id="vendor">
                                <option value="">-- Select Vendor --</option>
                                <option value="abc" selected>ABC Contractors</option>
                                <option value="xyz">XYZ Suppliers</option>
                                <option value="mno">MNO Services</option>
                                <option value="pqr">PQR Enterprises</option>
                            </select>
                        </div>
                    </div>
                </div>
         
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-users"></i> Labour & Expense Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labourCount">No Of Labour</label>
                            <input type="number" id="labourCount" min="1" max="50" value="5">
                        </div>
                        <div class="form-group">
                            <label for="wages">Wages (₹) per Labour</label>
                            <input type="number" id="wages" min="0" step="10" value="900">
                        </div>
                        <div class="form-group">
                            <label>Total Expense (₹)</label>
                            <div class="expense-box">
                                <div class="expense-value">₹ <span id="totalExpense">4,500</span></div>
                                <p>Auto-calculated as No. of Labour × Wages per Labour</p>
                            </div>
                        </div>
                    </div>
                </div>
         
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Labour Attendance Table</h2>
                    <p style="margin-bottom: 15px; color: #666;">Select labour names only. In/Out times, wages, type, activity, and vendor are applied globally.</p>
                    <div class="table-container">
                        <table id="labourTable">
                            <thead>
                                <tr>
                                    <th>Sr No</th>
                                    <th>Labour Name</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Rows generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
         
                <div class="action-buttons">
                    <button class="btn btn-primary" id="previewBtn">
                        <i class="fas fa-eye"></i> Preview Attendance
                    </button>
                    <button class="btn btn-primary" id="saveBtn" style="background-color:#4caf50;">
                        <i class="fas fa-save"></i> Save Attendance
                    </button>
                </div>
         
                <div class="preview-section" id="previewSection" style="display:none;">
                    <h3><i class="fas fa-file-alt"></i> Attendance Preview</h3>
                    <p style="margin-bottom: 20px; color: #667eea; font-weight: 600;">
                        Review details below. All global fields are applied to every labour.
                    </p>
                    <div class="preview-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label" style="font-weight:600;color:#555;">Company</div>
                            <div class="preview-value" id="previewCompany"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Branch</div>
                            <div class="preview-value" id="previewBranch"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Shift</div>
                            <div class="preview-value" id="previewShift"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Date</div>
                            <div class="preview-value" id="previewDate"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">In Time</div>
                            <div class="preview-value" id="previewInTime"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Out Time</div>
                            <div class="preview-value" id="previewOutTime"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Shift In-Charge</div>
                            <div class="preview-value" id="previewIncharge"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Labour Type</div>
                            <div class="preview-value" id="previewLabourType"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Activity</div>
                            <div class="preview-value" id="previewActivity"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Vendor</div>
                            <div class="preview-value" id="previewVendor"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Total Labour</div>
                            <div class="preview-value" id="previewLabourCount"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Wages per Labour</div>
                            <div class="preview-value" id="previewWages"></div>
                        </div>
                        <div class="preview-item" style="background:white;padding:15px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.05);border-left:4px solid #667eea;">
                            <div class="preview-label">Total Expense</div>
                            <div class="preview-value" id="previewTotalExpense"></div>
                        </div>
                    </div>
             
                    <div class="preview-table table-container">
                        <h4 style="margin:25px 0 15px; color:#667eea;">Labour Details</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Sr No</th>
                                    <th>Labour Name</th>
                                    <th>Labour Type</th>
                                    <th>Activity</th>
                                    <th>Vendor</th>
                                    <th>In Time</th>
                                    <th>Out Time</th>
                                    <th>Wages (₹)</th>
                                </tr>
                            </thead>
                            <tbody id="previewTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ====================== QUARRY ATTENDANCE (MONTHLY) ====================== -->
            <div id="quarryContent" class="attendance-content">
                <div class="header">
                    <h1><i class="fas fa-calendar-check"></i> Monthly Quarry Attendance Sheet</h1>
                    <p>SGX Minerals Private Limited - Anakapalli Branch</p>
                </div>
                <div class="instructions">
                    <strong>How to Mark Attendance:</strong><br>
                    • Cells start blank (white = not marked yet, assumed absent if not marked).<br>
                    • <strong>Single Click/Tap:</strong> Mark as Present for the selected shift (P for Day - Light Green, N for Night - Teal).<br>
                    • <strong>Double Click/Tap:</strong> Mark as Absent (A - Light Red).<br>
                    • Click again on Present: Toggle back to blank.<br>
                    • Double click on Absent: Toggle back to blank.
                </div>
   
                <div class="controls" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px; align-items: end;">
                    <div class="form-group">
                        <label for="monthQuarry">Select Month & Year</label>
                        <input type="month" id="monthQuarry" value="2025-12">
                    </div>
                    <div class="form-group">
                        <label for="shiftFilterQuarry">Shift for Single Click (Present)</label>
                        <select id="shiftFilterQuarry">
                            <option value="day">Day Shift (P - Green)</option>
                            <option value="night">Night Shift (N - Teal)</option>
                        </select>
                    </div>
                    <button class="btn" id="loadBtnQuarry">
                        <i class="fas fa-sync"></i> Load / Refresh Sheet
                    </button>
                </div>
   
                <div class="table-container">
                    <table id="attendanceTableQuarry">
                        <thead id="tableHeadQuarry"></thead>
                        <tbody id="tableBodyQuarry"></tbody>
                    </table>
                </div>
   
                <div class="summary-table table-container">
                    <h2 style="margin-bottom: 15px; color: #11998e;">Monthly Summary (Unmarked = Absent)</h2>
                    <table id="summaryTableQuarry">
                        <thead>
                            <tr>
                                <th>Labour Name</th>
                                <th>Total Day Shift Present</th>
                                <th>Total Night Shift Present</th>
                                <th>Grand Total Present</th>
                                <th>Total Working Days in Month</th>
                                <th>Absent Days</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Shared labour names (used in both Plant and Quarry)
        const labourNames = [
            "Rahul Sharma", "Amit Patel", "Vikram Singh", "Rajesh Kumar", "Suresh Reddy",
            "Anil Gupta", "Manoj Tiwari", "Deepak Verma", "Kiran Yadav", "Sanjay Mishra",
            "Prakash Singh", "Ramesh Choudhary", "Sohan Lal", "Mohan Das", "Harish Kumar",
            "Naresh Yadav", "Sunil Meena", "Arjun Rao", "Vijay Kumar", "Lokesh Sharma"
        ];

        // Shift defaults for Plant
        const shiftDefaults = {
            morning: { in: '06:00', out: '14:00' },
            general: { in: '09:00', out: '17:00' },
            night: { in: '22:00', out: '06:00' }
        };

        // Attendance Type Switcher
        document.getElementById('attendanceType').addEventListener('change', function() {
            const type = this.value;
            document.querySelectorAll('.attendance-content').forEach(c => c.classList.remove('active'));
            if (type) {
                document.getElementById(type + 'Content').classList.add('active');
                if (type === 'plant') initPlant();
                if (type === 'quarry') loadQuarryAttendanceSheet();
            }
        });

        /* ====================== PLANT FUNCTIONS ====================== */
        function initPlant() {
            generateTableRows(parseInt(document.getElementById('labourCount').value) || 5);
            updateTotalExpense();
            updateShiftTimes();
        }

        function generateTableRows(count) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>
                        <select class="labour-name" data-index="${i}">
                            <option value="">-- Select --</option>
                            ${labourNames.map(n => `<option value="${n}">${n}</option>`).join('')}
                        </select>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function updateShiftTimes() {
            const shift = document.getElementById('shift').value;
            if (shift && shiftDefaults[shift]) {
                document.getElementById('inTime').value = shiftDefaults[shift].in;
                document.getElementById('outTime').value = shiftDefaults[shift].out;
            }
        }

        function updateTotalExpense() {
            const count = parseInt(document.getElementById('labourCount').value) || 0;
            const wage = parseFloat(document.getElementById('wages').value) || 0;
            document.getElementById('totalExpense').textContent = (count * wage).toLocaleString('en-IN');
        }

        document.getElementById('labourCount').addEventListener('input', () => { generateTableRows(document.getElementById('labourCount').value); updateTotalExpense(); });
        document.getElementById('wages').addEventListener('input', updateTotalExpense);
        document.getElementById('shift').addEventListener('change', updateShiftTimes);
        document.getElementById('previewBtn').addEventListener('click', showPreview);
        document.getElementById('saveBtn').addEventListener('click', saveAttendance);

        function getGlobalDetails() {
            const getText = (id) => {
                const sel = document.getElementById(id);
                return sel.options[sel.selectedIndex]?.text || '';
            };
            return {
                labourType: getText('labourType'),
                activity: getText('activity'),
                vendor: getText('vendor')
            };
        }

        function showPreview() {
            // Update all preview fields...
            document.getElementById('previewCompany').textContent = document.getElementById('company').value;
            document.getElementById('previewBranch').textContent = document.getElementById('branch').value;
            document.getElementById('previewShift').textContent = document.getElementById('shift').options[document.getElementById('shift').selectedIndex].text;
            const date = new Date(document.getElementById('date').value);
            document.getElementById('previewDate').textContent = date.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('previewInTime').textContent = document.getElementById('inTime').value;
            document.getElementById('previewOutTime').textContent = document.getElementById('outTime').value;
            document.getElementById('previewIncharge').textContent = document.getElementById('shiftIncharge').options[document.getElementById('shiftIncharge').selectedIndex].text;
            const { labourType, activity, vendor } = getGlobalDetails();
            document.getElementById('previewLabourType').textContent = labourType;
            document.getElementById('previewActivity').textContent = activity;
            document.getElementById('previewVendor').textContent = vendor;
            document.getElementById('previewLabourCount').textContent = document.getElementById('labourCount').value;
            document.getElementById('previewWages').textContent = '₹ ' + parseFloat(document.getElementById('wages').value || 0).toLocaleString('en-IN');
            document.getElementById('previewTotalExpense').textContent = '₹ ' + document.getElementById('totalExpense').textContent;

            const previewTbody = document.getElementById('previewTableBody');
            previewTbody.innerHTML = '';
            document.querySelectorAll('#tableBody tr').forEach((row, i) => {
                const name = row.querySelector('.labour-name').value || '--';
                const wage = parseFloat(document.getElementById('wages').value || 0);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${i+1}</td>
                    <td>${name}</td>
                    <td>${labourType}</td>
                    <td>${activity}</td>
                    <td>${vendor}</td>
                    <td>${document.getElementById('inTime').value}</td>
                    <td>${document.getElementById('outTime').value}</td>
                    <td>₹ ${wage.toLocaleString('en-IN')}</td>
                `;
                previewTbody.appendChild(tr);
            });

            document.getElementById('previewSection').style.display = 'block';
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
        }

        function saveAttendance() {
            const count = parseInt(document.getElementById('labourCount').value);
            let missing = [];
            for (let i = 1; i <= count; i++) {
                if (!document.querySelector(`[data-index="${i}"]`).value) missing.push(i);
            }
            if (missing.length > 0) {
                alert(`Please select labour name for row(s): ${missing.join(', ')}`);
                return;
            }
            showPreview();
            alert('Attendance saved successfully! (In real app, this would send data to server)');
        }

        /* ====================== QUARRY FUNCTIONS ====================== */
        let daysInMonthQuarry = 0, yearQuarry = 0, monthQuarry = 0;

        document.getElementById('loadBtnQuarry').addEventListener('click', loadQuarryAttendanceSheet);
        document.getElementById('monthQuarry').addEventListener('change', loadQuarryAttendanceSheet);

        function loadQuarryAttendanceSheet() {
            const val = document.getElementById('monthQuarry').value;
            if (!val) return alert("Select month");
            [yearQuarry, monthQuarry] = val.split('-').map(Number);
            monthQuarry--;
            const lastDay = new Date(yearQuarry, monthQuarry + 1, 0);
            daysInMonthQuarry = lastDay.getDate();
            generateQuarryTable();
            updateQuarrySummary();
        }

        function generateQuarryTable() {
            const head = document.getElementById('tableHeadQuarry');
            const body = document.getElementById('tableBodyQuarry');
            head.innerHTML = '<tr><th rowspan="2">Sr No</th><th rowspan="2">Labour Name</th>' +
                Array.from({length: daysInMonthQuarry}, (_, i) => {
                    const d = new Date(yearQuarry, monthQuarry, i+1);
                    const dayName = d.toLocaleDateString('en-US', {weekday:'short'});
                    return `<th>${i+1}<br><small>${dayName}</small></th>`;
                }).join('') + '</tr>';
            
            body.innerHTML = '';
            labourNames.forEach((name, idx) => {
                let row = `<tr><td>${idx+1}</td><td>${name}</td>`;
                for (let d=1; d<=daysInMonthQuarry; d++) {
                    const id = `quarry-${idx}-${d}`;
                    row += `<td class="cell" id="${id}" onclick="handleQuarrySingleClick('${id}')" ondblclick="handleQuarryDoubleClick('${id}')"></td>`;
                }
                row += '</tr>';
                body.innerHTML += row;
            });
        }

        function handleQuarrySingleClick(cellId) {
            const cell = document.getElementById(cellId);
            const shift = document.getElementById('shiftFilterQuarry').value;
            if (cell.classList.contains('present-day') || cell.classList.contains('present-night')) {
                cell.classList.remove('present-day', 'present-night', 'absent');
                cell.textContent = '';
            } else if (cell.classList.contains('absent')) {
                cell.classList.remove('absent');
                cell.classList.add(shift === 'day' ? 'present-day' : 'present-night');
                cell.textContent = shift === 'day' ? 'P' : 'N';
            } else {
                cell.classList.add(shift === 'day' ? 'present-day' : 'present-night');
                cell.textContent = shift === 'day' ? 'P' : 'N';
            }
            updateQuarrySummary();
        }

        function handleQuarryDoubleClick(cellId) {
            const cell = document.getElementById(cellId);
            if (cell.classList.contains('absent')) {
                cell.classList.remove('absent', 'present-day', 'present-night');
                cell.textContent = '';
            } else {
                cell.classList.remove('present-day', 'present-night');
                cell.classList.add('absent');
                cell.textContent = 'A';
            }
            updateQuarrySummary();
        }

        function updateQuarrySummary() {
            const tbody = document.querySelector('#summaryTableQuarry tbody');
            tbody.innerHTML = '';
            labourNames.forEach((name, idx) => {
                let day = 0, night = 0;
                for (let d=1; d<=daysInMonthQuarry; d++) {
                    const cell = document.getElementById(`quarry-${idx}-${d}`);
                    if (cell.classList.contains('present-day')) day++;
                    if (cell.classList.contains('present-night')) night++;
                }
                const total = day + night;
                const absent = daysInMonthQuarry - total;
                tbody.innerHTML += `<tr>
                    <td>${name}</td>
                    <td>${day}</td>
                    <td>${night}</td>
                    <td>${total}</td>
                    <td>${daysInMonthQuarry}</td>
                    <td>${absent}</td>
                </tr>`;
            });
        }

        // Initial load - default to Plant
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('attendanceType').value = 'plant';
            document.getElementById('plantContent').classList.add('active');
            initPlant();
        });
    </script>
</body>
</html>
